<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Das groÃŸe Datebuch</title>
    <meta name="description" content="Date-Ideen fÃ¼r Nick & Solli">
    <meta name="theme-color" content="#f8f6f3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Datebuch">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’•</text></svg>">
    <link rel="manifest" href="manifest.json">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Quicksand:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- External Libraries -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>
    <script src="https://unpkg.com/earcut@2.2.4/dist/earcut.min.js"></script>

    <!-- Modular CSS -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/pages.css">
    <link rel="stylesheet" href="css/animations.css">
    <!-- Design Themes (Design System) -->
    <link rel="stylesheet" href="css/themes/theme-romantic.css" id="theme-css">
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-content">
            <div class="login-lock">ğŸ”</div>
            <h1 class="login-title">Das groÃŸe Datebuch</h1>
            <p class="login-subtitle">Nur fÃ¼r Nick & Solli</p>
            <form class="login-form" onsubmit="handleLogin(event)">
                <div class="login-input-wrapper">
                    <input type="password" id="loginPassword" class="login-input" placeholder="Passwort eingeben..." autocomplete="current-password">
                    <button type="button" class="login-biometric-btn" onclick="triggerBiometric()" title="Face ID / Touch ID">ğŸ”‘</button>
                </div>
                <button type="submit" id="loginBtn" class="login-btn">Entsperren â†’</button>
                <p class="login-error" id="loginError"></p>
            </form>
            <p class="login-hint">Face ID / Touch ID Ã¼ber Safari Keychain</p>
        </div>
    </div>

    <!-- Intro Splash -->
    <div class="intro" id="intro">
        <div class="intro-content">
            <div class="intro-icon">ğŸ’•</div>
            <h1 class="intro-title">Das groÃŸe Datebuch</h1>
            <p class="intro-subtitle">Nick & Solli</p>
            <button class="intro-btn" onclick="enterApp()">Buch Ã¶ffnen â†’</button>
        </div>
    </div>

    <!-- Main App -->
    <div class="app" id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-inner">
                <div class="logo">
                    <span>ğŸ“–</span>
                    <span>Datebuch</span>
                </div>
                <div class="search-container">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" class="search-input" id="globalSearch" placeholder="Suchen..." oninput="handleSearch(this.value)">
                    <div class="search-results" id="searchResults"></div>
                </div>
                <div class="header-actions">
                    <button class="theme-toggle" onclick="toggleTheme()" title="Theme wechseln">ğŸŒ™</button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-container">
            <div class="nav-tabs" id="navTabs">
                <button class="nav-tab active" data-category="all" onclick="showCategory('all')">ğŸ“… Alle</button>
                <button class="nav-tab" data-category="wellness" onclick="showCategory('wellness')">ğŸ’† Wellness</button>
                <button class="nav-tab" data-category="aktiv" onclick="showCategory('aktiv')">ğŸƒ Aktiv</button>
                <button class="nav-tab" data-category="handwerk" onclick="showCategory('handwerk')">ğŸ”¨ Handwerk</button>
                <button class="nav-tab" data-category="comedy" onclick="showCategory('comedy')">ğŸ˜‚ Comedy</button>
                <button class="nav-tab" data-category="essen" onclick="showCategory('essen')">ğŸ½ï¸ Essen</button>
                <button class="nav-tab" data-category="musik" onclick="showCategory('musik')">ğŸµ Musik</button>
                <button class="nav-tab" data-category="shows" onclick="showCategory('shows')">ğŸ­ Shows</button>
                <span class="nav-separator">|</span>
                <button class="nav-tab" data-category="builder" onclick="showCategory('builder')">ğŸ¯ Date Builder</button>
                <button class="nav-tab" data-category="travel" onclick="showCategory('travel')">ğŸŒ Travel</button>
                <button class="nav-tab" data-category="memories" onclick="showCategory('memories')">ğŸ“¸ Erinnerungen</button>
                <span class="nav-separator">|</span>
                <button class="nav-tab" data-category="favorites" onclick="showCategory('favorites')">â¤ï¸</button>
                <button class="nav-tab" data-category="nope" onclick="showCategory('nope')">ğŸ‘</button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Feierabend Toggle -->
            <div class="feierabend-toggle" id="feierabendToggle" style="display:none;">
                <span>ğŸŒ… Solli hat frei ab:</span>
                <select id="feierabendTime" onchange="filterByFeierabend()">
                    <option value="">Egal</option>
                    <option value="17:00">17:00</option>
                    <option value="17:30">17:30</option>
                    <option value="18:00">18:00</option>
                    <option value="18:30">18:30</option>
                    <option value="19:00">19:00</option>
                </select>
            </div>

            <!-- Widgets Bar -->
            <div class="widgets-bar" id="widgetsBar">
                <div class="widget-mini" id="weatherWidget">
                    <span>ğŸŒ¤ï¸</span>
                    <span id="weatherTemp">--Â°</span>
                </div>
                <div class="widget-mini clickable" onclick="toggleMiniCalendar()">
                    <span>ğŸ“…</span>
                    <span id="nextEventWidget">NÃ¤chstes Date laden...</span>
                </div>
                <button class="widget-mini btn-primary" onclick="openRoulette()">
                    <span>ğŸ²</span>
                    <span>ZufÃ¤lliges Date</span>
                </button>
            </div>

            <!-- Mini Calendar -->
            <div class="mini-calendar" id="miniCalendar" style="display:none;">
                <div class="mini-calendar-header">
                    <span class="mini-calendar-title" id="calendarTitle">Dezember 2025</span>
                    <div class="mini-calendar-nav">
                        <button onclick="changeCalendarMonth(-1)">â†</button>
                        <button onclick="changeCalendarMonth(1)">â†’</button>
                    </div>
                </div>
                <div class="mini-calendar-grid" id="calendarGrid"></div>
            </div>

            <!-- ALL EVENTS -->
            <section class="category-section active" id="section-all">
                <div class="category-header">
                    <h2>Alle Date-Ideen</h2>
                    <p>Eure gesammelten Erlebnisse fÃ¼r Hamburg und drumherum</p>
                </div>

                <!-- Tagesaktuelle Highlights -->
                <div class="events-section">
                    <h3 class="events-section-title">âœ¨ Highlights - Tagesaktuelle Events</h3>
                    <p class="events-section-subtitle">Besondere Dates mit festem Termin</p>
                    <div class="events-grid" id="tagesaktuelleEvents"></div>
                </div>

                <!-- Dauerbrenner -->
                <div class="events-section">
                    <h3 class="events-section-title">ğŸ”¥ Dauerbrenner</h3>
                    <p class="events-section-subtitle">Jederzeit verfÃ¼gbar - flexibel planbar</p>
                    <div class="events-grid" id="dauerbrennerEvents"></div>
                </div>
            </section>

            <!-- WELLNESS -->
            <section class="category-section" id="section-wellness">
                <div class="category-header">
                    <h2>ğŸ’† Wellness & Entspannung</h2>
                    <p>Zeit zum Abschalten und GenieÃŸen</p>
                </div>
                <div class="events-grid" id="wellnessEvents"></div>
            </section>

            <!-- AKTIV -->
            <section class="category-section" id="section-aktiv">
                <div class="category-header">
                    <h2>ğŸƒ Aktiv & Sport</h2>
                    <p>Gemeinsam in Bewegung kommen</p>
                </div>
                <div class="events-grid" id="aktivEvents"></div>
            </section>

            <!-- HANDWERK -->
            <section class="category-section" id="section-handwerk">
                <div class="category-header">
                    <h2>ğŸ”¨ Handwerk & Kreativ</h2>
                    <p>Zusammen etwas erschaffen</p>
                </div>
                <div class="events-grid" id="handwerkEvents"></div>
            </section>

            <!-- COMEDY -->
            <section class="category-section" id="section-comedy">
                <div class="category-header">
                    <h2>ğŸ˜‚ Comedy & Kabarett</h2>
                    <p>Gemeinsam lachen</p>
                </div>
                <div class="events-grid" id="comedyEvents"></div>
            </section>

            <!-- ESSEN -->
            <section class="category-section" id="section-essen">
                <div class="category-header">
                    <h2>ğŸ½ï¸ Essen & Kulinarik</h2>
                    <p>Kulinarische Entdeckungen</p>
                </div>
                <div class="events-grid" id="essenEvents"></div>
            </section>

            <!-- MUSIK -->
            <section class="category-section" id="section-musik">
                <div class="category-header">
                    <h2>ğŸµ Musik & Konzerte</h2>
                    <p>Gemeinsam Musik erleben</p>
                </div>
                <div class="events-grid" id="musikEvents"></div>
            </section>

            <!-- SHOWS -->
            <section class="category-section" id="section-shows">
                <div class="category-header">
                    <h2>ğŸ­ Shows & Theater</h2>
                    <p>BÃ¼hnenkunst erleben</p>
                </div>
                <div class="events-grid" id="showsEvents"></div>
            </section>

            <!-- DATE BUILDER -->
            <section class="category-section" id="section-builder">
                <div class="date-builder-container">
                    <div class="date-builder-header">
                        <h2>ğŸ¯ Date Builder</h2>
                        <p>Stelle dein perfektes Date zusammen</p>
                    </div>

                    <div class="date-builder-step">
                        <div class="step-header">
                            <span class="step-number">1</span>
                            <span class="step-title">Kategorie wÃ¤hlen</span>
                        </div>
                        <div class="category-pills" id="builderCategories"></div>
                    </div>

                    <div class="date-builder-step">
                        <div class="step-header">
                            <span class="step-number">2</span>
                            <span class="step-title">AktivitÃ¤t auswÃ¤hlen</span>
                        </div>
                        <div class="event-select-grid" id="builderEvents"></div>
                    </div>

                    <div class="date-builder-step">
                        <div class="step-header">
                            <span class="step-number">3</span>
                            <span class="step-title">Essen dazu?</span>
                        </div>
                        <div class="category-pills">
                            <button class="category-pill" onclick="setFoodOption('vorher')">ğŸ½ï¸ Vorher essen</button>
                            <button class="category-pill" onclick="setFoodOption('nachher')">ğŸ½ï¸ Nachher essen</button>
                            <button class="category-pill" onclick="setFoodOption('nein')">âŒ Kein Essen</button>
                        </div>
                    </div>

                    <div class="date-builder-step">
                        <div class="step-header">
                            <span class="step-number">4</span>
                            <span class="step-title">Drinks dazu?</span>
                        </div>
                        <div class="category-pills">
                            <button class="category-pill" onclick="setDrinksOption('ja')">ğŸ¸ Ja, Drinks!</button>
                            <button class="category-pill" onclick="setDrinksOption('nein')">âŒ Keine Drinks</button>
                        </div>
                    </div>

                    <div class="map-container">
                        <div id="dateBuilderMap"></div>
                    </div>

                    <div class="date-summary" id="dateSummary" style="display:none;">
                        <h3>âœ¨ Euer Date-Plan</h3>
                        <div id="summaryContent"></div>
                        <div class="summary-actions">
                            <button class="btn" onclick="shareToWhatsApp()">ğŸ“± WhatsApp</button>
                            <button class="btn" onclick="exportToCalendar()">ğŸ“… Kalender</button>
                            <button class="btn" onclick="openTransitRoute()">ğŸš‡ Route ab Arbeit</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TRAVEL -->
            <section class="category-section" id="section-travel">
                <div class="globe-section">
                    <div class="globe-header">
                        <h2>ğŸŒ Unsere Reisen</h2>
                        <p>Gemeinsam die Welt entdecken</p>
                    </div>

                    <div class="travel-stats">
                        <div class="travel-stat">
                            <div class="travel-stat-value" id="travelCountries">0</div>
                            <div class="travel-stat-label">LÃ¤nder</div>
                        </div>
                        <div class="travel-stat">
                            <div class="travel-stat-value" id="travelCities">0</div>
                            <div class="travel-stat-label">StÃ¤dte</div>
                        </div>
                        <div class="travel-stat">
                            <div class="travel-stat-value" id="travelWishlist">0</div>
                            <div class="travel-stat-label">Bucket List</div>
                        </div>
                    </div>

                    <div class="globe-container">
                        <canvas id="globeCanvas"></canvas>
                        <div class="globe-controls">
                            <button class="globe-btn" onclick="globeZoom(-1)">+</button>
                            <button class="globe-btn" onclick="globeZoom(1)">âˆ’</button>
                        </div>
                    </div>

                    <div class="globe-legend">
                        <div class="legend-item">
                            <div class="legend-dot visited"></div>
                            <span>Besucht</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot wishlist"></div>
                            <span>Bucket List</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- MEMORIES -->
            <section class="category-section" id="section-memories">
                <div class="category-header">
                    <h2>ğŸ“¸ Erinnerungen</h2>
                    <p>Eure schÃ¶nsten Momente</p>
                </div>
                <div class="memories-grid" id="memoriesGrid"></div>
            </section>

            <!-- FAVORITES -->
            <section class="category-section" id="section-favorites">
                <div class="category-header">
                    <h2>â¤ï¸ Favoriten</h2>
                    <p>Eure Lieblings-Dates</p>
                </div>
                <div class="events-grid" id="favoritesContainer"></div>
            </section>

            <!-- NOPE -->
            <section class="category-section" id="section-nope">
                <div class="category-header">
                    <h2>ğŸ‘ Ausgeblendet</h2>
                    <p>Diese Dates habt ihr ausgeblendet</p>
                </div>
                <div class="events-grid" id="nopeContainer"></div>
            </section>
        </main>

        <!-- Back to Top -->
        <button class="back-to-top" id="backToTop" onclick="scrollToTop()">â†‘</button>
    </div>

    <!-- Roulette Modal -->
    <div class="modal" id="rouletteModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('rouletteModal')">Ã—</button>
            <div class="modal-header">
                <h3>ğŸ² ZufÃ¤lliges Date</h3>
            </div>
            <div class="modal-body">
                <div class="roulette-result" id="rouletteResult">
                    <div class="roulette-emoji" id="rouletteEmoji">ğŸ²</div>
                    <h4 class="roulette-title" id="rouletteTitle">WÃ¼rfeln...</h4>
                    <div id="rouletteDetails"></div>
                    <div class="roulette-actions">
                        <button class="btn btn-primary" onclick="spinRoulette()">ğŸ² Nochmal</button>
                        <button class="btn btn-secondary" onclick="closeModal('rouletteModal')">SchlieÃŸen</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
        <span class="lightbox-close" onclick="closeLightbox()">Ã—</span>
        <span class="lightbox-nav lightbox-prev" onclick="navigateLightbox(-1)">â€¹</span>
        <img id="lightboxImg" src="" alt="">
        <span class="lightbox-nav lightbox-next" onclick="navigateLightbox(1)">â€º</span>
        <div class="lightbox-caption" id="lightboxCaption"></div>
    </div>

    <!-- Modular JavaScript -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
